<!DOCTYPE html>
<html lang="en">
<head>
  <title>Special Event</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="scripts/cookie.js"></script>
  <script src="scripts/brodata.js"></script>
  <link rel="stylesheet" href="theme.css">
  <link rel="icon" href="images/favicon.png">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  
  <style>
  	body {
      background: rgb(0,0,0);
    }
    
    body, html {
    	height: 100%;
    }
    .jumbotron {
    	background: none;
    }
    
    .text-white {
    	color: rgb(200,200,200);
    }
    
    .navbar-nav > li {
      font-weight: bold;
    }
    
    #myVideo {
      left: 0;
      top: 0;
      width: 100%;
      height:100%;
      object-fit:fill;
    }
    
    .spinner {
      position:absolute;
      width:11%;
      height:15%;
      overflow:hidden;
      display:none;
    }
    
    .spinner-1 {
      left:33.5%;
      top:22%;
    }
    
    .spinner-2 {
      left:56.5%;
      top:22%;
    }
    
    .spinner-3 {
      left:45%;
      top:51%;
    }
    
    @keyframes hand1 {
      0% {left: 23.5%;top:25%;}
      90% {left: 18.5%;top:25%;}
      100% {left: 23.5%;top:25%;}
    }
    
    @keyframes hand2 {
      0% {left: 46.5%;top:25%;}
      90% {left: 41.5%;top:25%;}
      100% {left: 46.5%;top:25%;}
    }
    
    @keyframes hand3 {
      0% {left: 35%;top:54%;}
      90% {left: 30%;top:54%;}
      100% {left: 35%;top:54%;}
    }
    
    .hand {
      position: absolute;
      width: 10%;
      height: 10%;
      visibility: hidden;
      z-index:1;
    }
    
    .hand-1 {
      animation: hand1 .65s infinite;
      visibility: visible;
    }
    
    .hand-2 {
      animation: hand2 .65s infinite;
      visibility: visible;
    }
    
    .hand-3 {
      animation: hand3 .65s infinite;
      visibility: visible;
    }
    
    
    
    
  </style>
</head>
<body>


<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="index.html">Broball Summit</a>
      <p id="broDisplay" class="navbar-brand pull-right"></p>
    </div>
    <ul class="nav navbar-nav">
      <li><a href="index.html"><img src="images/starspace.png"/> Scores</a></li>
      <li><a href="minigames.html"><img src="images/minigame.png"/> Mini-games</a></li>
      <li><a href="character.html"><img src="images/toadicon.png"/> Character</a></li>
      <li><a href="store.html"><img src="images/starspace.png"/> Star Space</a></li>
      <li class="active"><a href="#"><img src="images/chanceTime.png"/> ???</a></li>
      <li><a href="bowser.html"><img src="images/bowserspace.png"/> Bowser</a></li>
    </ul>
  </div>
</nav>



<div class="container text-white" style="position:relative;">
  
  <div id="preload" style="display:none">
    <img src="images/profiles/waluigi.png">
    <img src="images/profiles/luigi.png">
    <img src="images/profiles/boo.png">
    <img src="images/profiles/koopa kid.png">
    <img src="images/profiles/toadette.png">
    <img src="images/profiles/wario.png">
    <img src="images/profiles/donkey kong.png">
    <img src="images/profiles/shy guy.png">
    <img src="images/profiles/peach.png">
    <img src="images/profiles/blooper.png">
    <img src="images/profiles/dry bones.png">
    <img src="images/values/star1.png">
    <img src="images/values/star2.png">
    <img src="images/values/star3.png">
    <img src="images/values/coin10.png">
    <img src="images/values/coin20.png">
    <img src="images/values/coin30.png">
    <img src="images/values/coin40.png">
    <img src="images/values/coin50.png">
    <img src="images/values/coinall.png">
  </div>
  <audio loop>
    <source src="sounds/chancetime.ogg">
  </audio>
  <h2 class="text-white">??? Chance Time ???</h2>
  <div class="row" style="text-align:center;">
    <i class="fas fa-microphone-slash" style="font-size:36px;"></i>
  </div>
  <div style="height:10px;">
  </div>
  <div style="position:relative;">
    <video autoplay muted id="myVideo" onPause="videoPaused();">
      <source src="video/chancetime.mp4#t=0,6.2" type="video/mp4">
    </video>
    <img id="stage-pic" src="images/chancetimestage.png" style="position:absolute;left:0px;top:0px;width:100%;height:100%;display:none;">
    <div style="position:absolute;left:0px;top:0px;width:100%;height:100%;">
      <img class="hand" src="images/hand.png">
      <div class="spinner spinner-1 spinner-unused" spinner-number="1">
        <img class="top-pic" src="images/question.png" style="width:100%;height:100%;position:absolute;top:-100%;">
        <img class="bot-pic" src="images/question.png" style="width:100%;height:100%;position:absolute;top:0%;">
        <option style="display:none;">profiles/Waluigi</option>
        <option style="display:none;">profiles/Luigi</option>
        <option style="display:none;">profiles/Boo</option>
        <option style="display:none;">profiles/Koopa Kid</option>
        <option style="display:none;">profiles/Toadette</option>
        <option style="display:none;">profiles/Wario</option>
        <option style="display:none;">profiles/Donkey Kong</option>
        <option style="display:none;">profiles/Shy Guy</option>
        <option style="display:none;">profiles/Peach</option>
        <option style="display:none;">profiles/Blooper</option>
        <option style="display:none;">profiles/Dry Bones</option>
      </div>
      <div class="spinner spinner-2 spinner-unused" spinner-number="2">
        <img class="top-pic" src="images/question.png" style="width:100%;height:100%;position:absolute;top:-100%;">
        <img class="bot-pic" src="images/question.png" style="width:100%;height:100%;position:absolute;top:0%;">
        <option style="display:none;">profiles/Waluigi</option>
        <option style="display:none;">profiles/Luigi</option>
        <option style="display:none;">profiles/Boo</option>
        <option style="display:none;">profiles/Koopa Kid</option>
        <option style="display:none;">profiles/Toadette</option>
        <option style="display:none;">profiles/Wario</option>
        <option style="display:none;">profiles/Donkey Kong</option>
        <option style="display:none;">profiles/Shy Guy</option>
        <option style="display:none;">profiles/Peach</option>
        <option style="display:none;">profiles/Blooper</option>
        <option style="display:none;">profiles/Dry Bones</option>
      </div>
      <div class="spinner spinner-3 spinner-unused" spinner-number="3">
        <img class="top-pic" src="images/question.png" style="width:100%;height:100%;position:absolute;top:-100%;">
        <img class="bot-pic" src="images/question.png" style="width:100%;height:100%;position:absolute;top:0%;">
        <option style="display:none;">values/star1</option>
        <option style="display:none;">values/coin10</option>
        <option style="display:none;">values/coin30</option>
        <option style="display:none;">values/coin40</option>
        <option style="display:none;">values/coin20</option>
        <option style="display:none;">values/star1</option>
        <option style="display:none;">values/coin50</option>
        <option style="display:none;">values/star1</option>
        <option style="display:none;">values/star3</option>
        <option style="display:none;">values/coinall</option>
      </div>
    </div>
  </div>
  
</div>
                             
<script>
	var broName = getCookie("broName");
  var currentSpinner = $(".spinner-2");
  var spindex = 0;
  var spinning = false;
  //var spinSpeed = 400;
  var spinSpeed = 250;
  //var spinSpeed = 125;
  spinSpeeds = [125, 250, 400];
  
	if (broName == "")
		window.location.assign("welcome.html");
		
	
  getBros(function (fullNames, names, characters) {
    
  
    var index = fullNames.findIndex(function(name){return name == broName});
    var characterName = characters[index];
    //$("#characterName > strong").html(characterName);
    $("#broDisplay").html("Welcome, "+names[index]+"!");
    $("#scorecard-body .img-responsive").attr("src", "images/profiles/"+escapeName(characterName.toLowerCase())+".png").css("visibility", "visible");
    
  });
  
  $(".fa-microphone-slash").click(function () {
    //$(this).removeClass("fa-microphone-slash").addClass("fa-microphone");
    $(this).toggleClass("fa-microphone-slash fa-microphone");
    var audio = $("audio")[0];
    audio.volume = .3;
    if (audio.paused == true) {
      audio.play();
    } else {
      audio.pause();
    }
  });
  
  $(".spinner").click(function() {
    if (!spinning && $(this).is(currentSpinner)) {
      spinning = true;
      spin();
      $(".hand").removeClass("hand-1 hand-2 hand-3");
    } else if ($(this).is(currentSpinner)) {
      spinning = false;
      currentSpinner.removeClass("spinner-unused");
      
      spinnerDone(currentSpinner);
      currentSpinner = $();
      
      setTimeout(function () {
        initChanceTime();
      }, 1000);
    }
  });
  
  getBros(function (fullnames, names, characters) {
    
  });
  
  function spin() {
    currentSpinner.find("img.bot-pic").attr("src", currentSpinner.find("img.top-pic").attr("src")).css("top", "0%");
    spindex = (spindex + 1) % currentSpinner.find("option").length;
    currentSpinner.find("img.top-pic").attr("src", "images/"+currentSpinner.find("option")[spindex].innerHTML.toLowerCase()+".png").css("top", "-100%");
        
    currentSpinner.find("img.bot-pic").animate({top: "100%"}, spinSpeed, 'linear');
    currentSpinner.find("img.top-pic").animate({top: "0%"}, spinSpeed, 'linear', function() {
      if (spinning) {
        spin();
      }// else alert("You picked "+currentSpinner.find("option")[spindex].innerHTML+"!");
    });
  }
  
  function videoPaused() {
    $(".spinner").fadeIn();
    $("#stage-pic").fadeIn();
    initChanceTime();
  }
  
  function initChanceTime() {
  spindex = 0;
    var spinners = $(".spinner-unused");
    if (spinners.length > 0) {
      var firstOne = (Math.floor(Math.random()*spinners.length)+1);
      currentSpinner = $(spinners[firstOne-1]);
      spinSpeed = spinSpeeds[spinners.length - 1];
      //$(".hand").addClass("hand-"+currentSpinner.attr("spinner-number"));
      currentSpinner.click();
    } else {
      currentSpinner = $();
      //Chance time is over
    }
  }
  
  function spinnerDone(spinner) {
    var spinnerNumber = spinner.attr("spinner-number");
    var picked = spinner.find("option")[spindex].innerHTML;
    $(".spinner option:contains("+picked+")").remove();
  }
  
</script>

</body>
</html>
